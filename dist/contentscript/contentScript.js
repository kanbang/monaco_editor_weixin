"use strict";function postMessageToNW(e){if(e.webviewID=webviewID,e.weappID=weappID,!portInit)return void portMsgQuery.push(e);for(__msgQueue[e.__id]=e;__msgQueue[__id];)port.postMessage(__msgQueue[__id]),delete __msgQueue[__id],__id++}function postMessageToWebPage(e){return postMessageInit?(e.webviewID=webviewID,void window.postMessage(e,"*")):void postMessageQuery.push(e)}function handleMsg(e){var o=e.command;if("SHAKE_HANDS"===o)portInit=!0,portMsgQuery.length&&(portMsgQuery.forEach(function(e){postMessageToNW(e)}),portMsgQuery=[]);else if("ERR_CONNECTION_RESET"!==o||showProxyErr){if("SHOW_SYS_INFO"===o){var n=e.msg,t=n.memory,r=n.restartInfo,a=+new Date-r.projectBeginTime,s=r.projectRestartNum;console.group(new Date+" 工具系统信息"),console.info("工具已运行 "+(a/1e3).toFixed(2)+" 秒，执行编译 "+s+" 次， 当前内存占用 "+t.toFixed(2)+"m"),console.table(n.info),console.groupEnd()}else if("SHOW_CUSTOM_ANALYSIS_REPORT"===o){var i=e.msg,c=i.actionData,l=c.data,p=Object.prototype.toString.call(l).slice(8,-1);if("Object"===p){console.group(new Date+" 自定义分析 上报成功"),c.eventID&&console.info("event ID: "+c.eventID),c.page&&console.info("page: "+c.page);var g={};for(var u in l)g[u]={"数据":l[u]};console.table(g),console.groupEnd()}else if("Array"===p){var v={};try{var f=JSON.parse(i.config),d=f.find(function(e){return e.eventID===c.eventID}),w=!0,y=!1,m=void 0;try{for(var _,b=d.eventTarget[Symbol.iterator]();!(w=(_=b.next()).done);w=!0){var I=_.value;for(var D in I.data)v[D.toString()]={selector:I.data[D],parent:I}}}catch(e){y=!0,m=e}finally{try{!w&&b.return&&b.return()}finally{if(y)throw m}}}catch(e){v=null}console.group(new Date+" 自定义分析 上报成功");try{if(c.eventID&&console.info("event ID: "+c.eventID),c.page&&console.info("page: "+c.page),l&&l.length>0){var S=v[l[0].id].parent;S.trigger&&console.info("trigger: "+S.trigger),S.action&&console.info("action: "+S.action)}}catch(e){}try{if(v){var h=!0,M=!1,E=void 0;try{for(var N,O=l[Symbol.iterator]();!(h=(N=O.next()).done);h=!0){var T=N.value;T["字段值"]=v[T.id].selector,T["数据"]=T.value}}catch(e){M=!0,E=e}finally{try{!h&&O.return&&O.return()}finally{if(M)throw E}}l&&l.length>0&&console.table(l,["字段值","数据"]),console.groupEnd()}else l&&l.length>0&&console.table(l,["id","数据"]),console.groupEnd()}catch(e){console.groupEnd()}}}else if("SHOW_CUSTOM_ANALYSIS_GET_APP_CONFIG"===o){console.group(new Date+" 自定义分析 配置拉取成功");var P=e.msg;try{var Q=JSON.parse(P),A=Q[0],W={};W["事件 ID"]={value:A.eventID},W["事件名"]={value:A.eventName},console.info("事件信息"),console.table(W);for(var x=A.eventTarget,F=0;F<x.length;F++){var H=x[F],C={};for(var j in H)"string"==typeof H[j]&&(C[j]={value:H[j]});console.group("动作 #"+(F+1)+"："),console.info("触发条件："),console.table(C);var R=[];for(var L in H.data)R.push({"字段值":H.data[L]});console.info("上报数据："),console.table(R),console.groupEnd()}}catch(e){}console.groupEnd()}else if("SHOW_CUSTOM_ANALYSIS_ON_APP_CONFIG"===o){console.group(new Date+" 自定义分析 收到最新配置");var q=e.msg;try{var Y=JSON.parse(q),G=Y[0],J={};J["事件 ID"]={value:G.eventID},J["事件名"]={value:G.eventName},console.info("事件信息"),console.table(J);for(var U=G.eventTarget,K=0;K<U.length;K++){var k=U[K],B={};for(var V in k)"string"==typeof k[V]&&(B[V]={value:k[V]});console.group("动作 #"+(K+1)+"："),console.info("触发条件："),console.table(B);var z=[];for(var X in k.data)z.push({"字段值":k.data[X]});console.info("上报数据："),console.table(z),console.groupEnd()}}catch(e){}console.groupEnd()}}else{var Z=e.msg,$="因为网络代理软件或者 VPN 影响，工具无法加载本地模拟开发服务 "+Z.url+" 请尝试以下任一解决方案\n1.关闭相关网络代理软件，重新编译成功后，再启动相关网络代理软件；\n2.配置相关软件不针对 *.appservice.open.weixin.qq.com 和 *.debug.open.weixin.qq.com 进行代理；\n3.配置相关软件不针对 开发者工具 做代理。";console.group(new Date+" 工具加载错误"),console.error($),console.groupEnd(),showProxyErr=!0}}function receiveMessageFromPageFrame(e){"backgroundjs"===e.to&&postMessageToNW(e)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ua=navigator.userAgent,webviewID=parseInt(ua.match(/webview\/(\d*)/)[1]),weapp=ua.match(/weapp\/(\d*)/),weappID=weapp?parseInt(weapp[1]):void 0;window.runtime={};var portInit=!1,postMessageInit=!1,portMsgQuery=[],postMessageQuery=[],port=window.runtime.port=chrome.runtime.connect("",{name:"webview"+webviewID}),__msgQueue={},__id=0,showProxyErr=!1;port.onMessage.addListener(function(e){var o=e.to;"contentscript"===o?handleMsg(e):"webframe"===o?postMessageToWebPage(e):"appservice"===o&&postMessageToWebPage(e)}),window.addEventListener("message",function(e){var o=e.data;if(o&&"object"===("undefined"==typeof o?"undefined":_typeof(o))&&o.webviewID===webviewID){var n=o.comefrom,t=o.to;if("webframe"===n){var r=o.command;"contentscript"===t&&"SHAKE_HANDS"===r?(postMessageInit=!0,postMessageQuery.length&&(postMessageQuery.forEach(function(e){postMessageToWebPage(e)}),postMessageQuery=[])):receiveMessageFromPageFrame(o)}}});