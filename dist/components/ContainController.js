"use strict";function init(){var t=require("../lib/react.js"),e=require("../actions/windowActions.js"),s=require("../stores/windowStores.js"),i=require("../stores/webviewStores.js"),o=require("../stores/projectStores.js"),r=(require("../actions/projectActions.js"),require("../common/log/log.js")),n=require("./setting/setting.js"),a=require("./lunch/lunch.js"),c=require("./create/create.js"),u=require("./confirm/confirm.js"),h=require("./toast/toast.js"),l=require("./custompre/custompreview.js"),m=require("./customanalysis/custom-analysis.js"),p=require("./custompre/widgetCustom.js"),g=require("./custompre/searchcustom.js"),v=require("./Main.js"),_=require("../utils/newReport.js"),f=require("../config/config.js"),j=f.SELECT_URL_TYPE,L=f.SELECT_UNKNOW_TYPE,S=function(t){e.showTipsMsg({msg:t,type:"error"})},d=global.Win,w=void 0,T=void 0,E=void 0,x=void 0,W={editor:1,proxy:2,notify:3},O=t.createClass({displayName:"ContainController",getInitialState:function(){var t=!!Object.keys(s.getUserInfo()).length,i=o.getLastSelect(),r=i===j,n="",a=!1;if(i!==j&&i!==L){n=i;var c=s.getEditorConfig("autoRefresh");void 0===c&&e.updateEditorConfig({autoRefresh:n.watcher})}var u=s.getLastWinStatus()||{};return{hasLogin:t,commonUrl:r,project:n,type:i,showSetting:a,lastWinStatus:u,cursorLoading:!1}},componentDidMount:function(){this.state.hasLogin&&(this.state.project||this.state.commonUrl)&&this.appToMax(),s.on("UPDATA_USER_INFO",this._upDataUserInfo),i.on("NOT_LOGIN",this.goToLogin),i.on("INVALID_LOGIN",this.goToLogin),o.on("CLOSE_PROJECT",this._closeProject),o.on("DEL_PROJECT",this._delProject),s.on("SHOW_SETTING",this._showSetting),d.on("maximize",this._maximize),d.on("restore",this._restore),d.on("enter-fullscreen",this._enterFullscreen),d.on("resize",this._resize),d.on("move",this._move)},componentWillUnmount:function(){s.removeListener("UPDATA_USER_INFO",this._upDataUserInfo),i.removeListener("NOT_LOGIN",this.goToLogin),i.removeListener("INVALID_LOGIN",this.goToLogin),o.removeListener("CLOSE_PROJECT",this._closeProject),o.removeListener("DEL_PROJECT",this._delProject),s.removeListener("SHOW_SETTING",this._showSetting),d.removeListener("maximize",this._maximize),d.removeListener("restore",this._restore),d.removeListener("enter-fullscreen",this._enterFullscreen),d.removeListener("resize",this._resize),d.removeListener("move",this._move)},setLastWinStatus:function(t){this.setState({lastWinStatus:t}),(this.state.commonUrl||this.state.project)&&s.setLastWinStatus(t)},restore:function(t){var e=this,i=d.isFullscreen;clearTimeout(E),clearTimeout(x);var o=function o(){if(d.removeListener("move",e._move),d.removeListener("resize",e._resize),d.removeListener("restore",e._restore),"init"===t)d.resizeTo(nw.App.manifest.window.width,nw.App.manifest.window.height),setTimeout(function(){d.setPosition("center"),setTimeout(function(){d.on("resize",e._resize),d.on("move",e._move),d.on("restore",e._restore)},300)},500);else{var r=s.getLastWinStatus();r.isFullscreen=!1,r.status="restore";var n=void 0===r.x?100:r.x,a=void 0===r.y?100:r.y;n=n<-300?0:n,a=a<-300?0:a,d.moveTo(n,a);var c=void 0===r.width?nw.App.manifest.window.width:r.width,u=void 0===r.height?nw.App.manifest.window.height:r.height;d.resizeTo(c,u),e.setLastWinStatus(r),setTimeout(function(){d.on("resize",e._resize),d.on("move",e._move),d.on("restore",e._restore)},300)}i&&d.removeListener("restore",o)};i?(d.on("restore",o),d.leaveFullscreen()):o()},_move:function(){var t=this;clearTimeout(x),x=setTimeout(function(){var e=Object.assign({},t.state.lastWinStatus);e.x=d.x,e.y=d.y,t.setLastWinStatus(e)},500)},_resize:function(){var t=this;clearTimeout(E),E=setTimeout(function(){var e=Object.assign({},t.state.lastWinStatus);e.width=d.width,e.height=d.height,t.setLastWinStatus(e)},500)},_enterFullscreen:function(){var t=Object.assign({},this.state.lastWinStatus);t.isFullscreen=!0,this.setLastWinStatus(t)},_maximize:function(){clearTimeout(E),clearTimeout(x);var t=Object.assign({},this.state.lastWinStatus);t.status="max",w=d.height,T=d.width,this.setLastWinStatus(t)},_restore:function(){var t=Object.assign({},this.state.lastWinStatus);t.status="restore",t.isFullscreen=!1,d.width===T&&d.height===w&&(t.status="max"),this.setLastWinStatus(t)},_upDataUserInfo:function(t){var e=this,s=!!Object.keys(t).length;s?(this.setState({hasLogin:!0}),(this.state.project||this.state.commonUrl)&&this.appToMax()):setTimeout(function(){e.goToLogin()},50)},_delProject:function(){this.setState({project:"",commonUrl:""}),this.restore("init")},_closeProject:function(){i.setCurrentWebviewID(0),this.setState({project:"",commonUrl:""}),this.restore("init")},_setCursorLoading:function(t){this.setState({cursorLoading:t})},goToLogin:function(){this.setState({hasLogin:!1,commonUrl:"",project:""}),this.restore("init")},handleOnClick:function(t){e.bodyClick(t)},appQuit:function(){r.info("ContainController.js exit"),nw.App.quit()},appToMax:function(){var t=this.state.lastWinStatus,e=t.status;t.isFullscreen?d.enterFullscreen():"max"===e||void 0===e?d.maximize():this.restore()},appMax:function(){var t=this.state.lastWinStatus,e=t.status;"max"!==e?d.maximize():this.restore()},appMin:function(){global.Win.minimize()},goMain:function(t){var e=this;t?o.setProjectConfig(t,{refresh:!0},function(s){return s?void S(s):(e.setState({commonUrl:!1,project:t,type:t}),void e.appToMax())}):(this.setState({commonUrl:!0,project:"",type:j}),o.setProjectType(j),this.appToMax());t?_("project_open",t.appid):_("url_open")},_showSetting:function(){this.setState({showSetting:!this.state.showSetting})},render:function(){var e=void 0,s=!this.state.commonUrl&&!this.state.project,i={};return i[W.proxy]=!0,i[W.editor]=!s&&!!this.state.project,i[W.notify]=!s,e=this.state.hasLogin?s?t.createElement(c,{appQuit:this.appQuit,goMain:this.goMain,type:this.state.type}):t.createElement(v,{lastWinStatus:this.state.lastWinStatus,project:this.state.project,appQuit:this.appQuit,appMax:this.appMax,appMin:this.appMin}):t.createElement(a,{appQuit:this.appQuit}),t.createElement("div",{onClick:this.handleOnClick,style:this.state.cursorLoading?{cursor:"wait !important"}:{}},e,t.createElement(n,{show:this.state.showSetting,toggleShow:this._showSetting,project:this.state.project,enables:i,category:W,inSelectProject:s,setCursorLoading:this._setCursorLoading}),t.createElement(l,null),t.createElement(p,null),t.createElement(m,{project:this.state.project}),t.createElement(g,null),t.createElement(h,null),t.createElement(u,null))}});_exports=O}var _exports;init(),module.exports=_exports;