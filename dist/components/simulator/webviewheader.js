"use strict";function init(){var t=(require("path"),require("fs"),require("../../lib/react.js")),e=require("../../cssStr/cssStr.js"),i=require("../../stores/webviewStores.js"),a=(require("../../stores/windowStores.js"),require("../../actions/leftviewActions.js")),o=require("../../actions/webviewActions.js"),s=require("../../weapp/utils/tools.js"),n=(require("../../common/log/log.js"),require("../../weapp/utils/projectManager.js"),"white"),r="#000000",h=t.createClass({displayName:"WebviewHeader",getInitialState:function(){var t=this.props,e=t.project,i=t.appJSON,a=t.pageJSON,o="",s="";return e&&(o=a.navigationBarTitleText||i.window.navigationBarTitleText||"",s=a.navigationBarRightButton||i.window.navigationBarRightButton),{title:o,navigationBarRightButton:s,webviewID:parseInt(this.props.webviewID),canGoBack:!1,showRightBtn:!0,showBarLoading:!1,frontColor:void 0,backgroundColor:void 0,alpha:1,animation:void 0}},_upWebviewStatus:function(t,e){0!==t&&(e.canGoBack=!0),Object.assign(this.state,e),this.setState(this.state)},_cleanWebview:function(){this.state.webviewID;this.setState({title:"",showRightBtn:!0,showBarLoading:!1})},_setInterfaceFromPageFrame:function(t){var e=t.name;"setNavigationBarTitle"===e?this.setState({title:t.value}):"showNavigationBarLoading"===e?this.setState({showBarLoading:!0}):"hideNavigationBarLoading"===e?this.setState({showBarLoading:!1}):"setNavigationBarRightButton"===e?this.setState({navigationBarRightButton:{iconPath:t.iconPath,text:t.text,hide:t.hide}}):"setNavigationBarColor"===e&&this.setState({frontColor:t.frontColor,backgroundColor:t.backgroundColor,alpha:t.alpha,animation:t.animation})},_setInterfaceRes:function(t,e,i,a){i&&("hideOptionMenu"===e||"hideMenuItems"===e||"hideAllNonBaseMenuItem"===e?this.setState({showRightBtn:!1}):"showOptionMenu"!==e&&"showMenuItems"!==e&&"showAllNonBaseMenuItem"!==e||this.setState({showRightBtn:!0}))},showFooter:function(){"function"==typeof this.props.headerOperate&&this.props.headerOperate("showFooter"),o.postMessageToAS({eventName:"onTapNavigationBarRightButton"})},componentDidMount:function(){var t=this.state.webviewID;i.on("SET_INTERFACE_RES_"+t,this._setInterfaceRes),i.on("UP_WEBVIEW_STATUS_"+t,this._upWebviewStatus),i.on("CLEAN_WEBVIEW_"+t,this._cleanWebview),i.on("SET_INTERFACT_FROMPAGEFRAME_"+t,this._setInterfaceFromPageFrame)},componentWillUnmount:function(){var t=this.state.webviewID;i.removeListener("CLEAN_WEBVIEW_"+t,this._cleanWebview),i.removeListener("SET_INTERFACE_RES_"+t,this._setInterfaceRes),i.removeListener("UP_WEBVIEW_STATUS_"+t,this._upWebviewStatus),i.removeListener("SET_INTERFACT_FROMPAGEFRAME_"+t,this._setInterfaceFromPageFrame)},handleRightClick:function(){a.clickRightHeader(this.state.webviewID)},goBack:function(t){this.props.goBack()},closeLocation:function(){this.goBack(),this.props.closeLocation()},chooseLocation:function(){this.goBack(),this.props.chooseLocation()},getNavigationBarRightButton:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.text,i=t.iconPath,a=t.hide;return e||i||a?a?{hide:!0,text:!1,iconPath:!1}:i?{iconPath:i}:e.length>4?{}:{text:e}:{text:e,iconPath:i,hide:a}},render:function(){var i=this,a=this.props,o=a.offset,h=a.hideBack,c=a.webviewID,l=a.project,d=(a.isMap,a.goBack,a.pageJSON),u=a.appJSON;if(this.props.isMap)return t.createElement("div",{style:{width:o.width},className:"simulator-hd"},t.createElement("div",{onClick:this.closeLocation,className:"simulator-hd-back"},t.createElement("span",null,"取消")),t.createElement("h3",{className:"simulator-hd-title"},"位置"),t.createElement("div",{onClick:this.chooseLocation,className:"simulator-hd-option"},"发送"));var g=this.state.animation,v=void 0;g&&(v=g.timingFunc,"easeIn"===v?v="ease-in":"easeOut"===v?v="ease-out":"easeInOut"===v&&(v="ease-in-out"));var w={width:o.width,backgroundColor:this.state.backgroundColor||d.navigationBarBackgroundColor||u.window.navigationBarBackgroundColor||r,opacity:this.state.alpha,transition:g?"all "+(g.duration?g.duration:0)+"ms "+(v?v:"linear"):"none"},p=!h&&this.state.canGoBack?{}:e.visibilityHidden;0==c&&l&&(p=e.visibilityHidden);var m={};this.props.project||this.state.showRightBtn||(m=e.visibilityHidden),this.state.frontColor&&(m.color=this.state.frontColor);var B={color:this.state.frontColor||d.navigationBarTextStyle||u.window.navigationBarTextStyle||n};"white"===B.color||"black"===B.color||/^(#fff|#ffffff|#000|#000000)$/i.test(B.color)||(B.color="white");var f={borderColor:this.state.frontColor||d.navigationBarTextStyle||u.window.navigationBarTextStyle||n};"white"===f.color||"black"===f.color||/^(#fff|#ffffff|#000|#000000)$/i.test(f.color)||(f.color="white");var E="black"===B.color||/^(#000|#000000)$/.test(B.color)?"ui-icon-dots-black":"ui-icon-dots-white",S=this.state.title||d.navigationBarTitleText||u.window.navigationBarTitleText,_=this.props.showRecordWording?"  录音中...":"",b=this.getNavigationBarRightButton(this.state.navigationBarRightButton),N=t.createElement("i",{className:E});if(b.hide)m=e.visibilityHidden;else if(b.iconPath){var R=""+s.getBaseURL(this.props.project)+b.iconPath+"?r="+Math.random();N=t.createElement("img",{style:{height:30},src:R})}else if(b.text){var k=Object.assign({},B);k.fontSize="12px",N=t.createElement("p",{style:k},b.text," ")}return t.createElement("div",{style:w,className:"simulator-hd",ref:function(t){window.headerDOM||(window.headerDOM=[]),window.headerDOM.push(t),i.headerDOM=t}},t.createElement("div",{onClick:this.goBack,style:p,className:"simulator-hd-back"},t.createElement("i",{className:"simulator-hd-back-icon",style:f}),t.createElement("span",{style:B},"返回")),t.createElement("h3",{className:"simulator-hd-title",style:B},this.state.showBarLoading?t.createElement("i",{className:"simulator-hd-title-loading"}):"",S,_),t.createElement("div",{style:m,onClick:this.showFooter,className:"simulator-hd-option"},N))}});_exports=h}var _exports;init(),module.exports=_exports;