"use strict";function init(){var t=require("../../lib/react"),e=require("../popupwindow/externalpopupwindow.js"),i=require("../../config/urlConfig.js"),s=require("../../common/request/request.js"),n=require("../../actions/windowActions.js"),o=require("../../actions/webviewActions.js"),r=(require("../../stores/webviewStores.js"),require("../../stores/windowStores.js")),a=require("../simulator/actions/simulatorActions.js"),c=require("../../config/config.js"),u=function(t){return Object.prototype.toString.call(t).slice(8,-1)},l=t.createClass({displayName:"CustomAnalysis",getInitialState:function(){return{show:!1,open_ticket:""}},componentDidMount:function(){this._showCustomAnalysis=this.showCustomAnalysis.bind(this),this._closeCustomAnalysis=this.closeCustomAnalysis.bind(this),r.on("SHOW_CUSTOM_ANALYSIS",this._showCustomAnalysis)},componentWillUnmount:function(){r.removeListener("SHOW_CUSTOM_ANALYSIS",this._showCustomAnalysis)},showCustomAnalysis:function(){this.state.show?this.win&&this.win.focus():(this.setState({show:!0}),this.getTicket())},closeCustomAnalysis:function(){try{n.closeCustomAnalysis(),o.updateCustomAnalysisConfig("")}catch(t){}finally{this.setState({show:!1,open_ticket:""})}},getTicket:function(){var t=this;s({url:i.getDataOpenTicket+"?appid="+this.props.project.appid,needToken:1},function(e,i,s){try{s=JSON.parse(s),t.setState({open_ticket:s.open_ticket})}catch(t){}})},onMessage:function(t){"Object"===u(t.data)&&"GET_APP_CONFIG"===t.data.type&&(o.updateCustomAnalysisConfig(t.data.config),a("S_POSTMSG_TO_AS",0,{eventName:"onAppConfig",data:{data:t.data.config,type:1}}),n.showInConsole(c.CUSTOM_ANALYSIS_ON_APP_CONFIG,t.data.config))},onWindowOpen:function(t){this.win=t,t.on("new-win-policy",function(t,e,i){i.ignore(),nw.Shell.openExternal(e)})},onWindowClose:function(t){this.closeCustomAnalysis()},render:function(){if(!this.state.open_ticket||!this.state.show)return null;var i=void 0,s=void 0;try{i=1200,s=nw.Screen.screens[0].work_area.height;var n=!0,o=!1,r=void 0;try{for(var a,c=nw.Screen.screens[Symbol.iterator]();!(n=(a=c.next()).done);n=!0){var u=a.value.work_area,l=u.width,h=u.height;i>l&&(i=l),s>h&&(s=h)}}catch(t){o=!0,r=t}finally{try{!n&&c.return&&c.return()}finally{if(o)throw r}}}catch(t){i=1200,s=global.Win.height}return t.createElement(e,{width:i,height:s,url:"https://mp.weixin.qq.com/wxopen/userdefineanalysis_ide?action=event_list&dev_code="+this.state.open_ticket+"&appid="+this.props.project.appid+"&devtools=1",onMessage:this.onMessage.bind(this),onWindowOpen:this.onWindowOpen.bind(this),onWindowClose:this.onWindowClose.bind(this)})}});_exports=l}var _exports;init(),module.exports=_exports;