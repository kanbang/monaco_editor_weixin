"use strict";function init(){var e,t=require("path"),o=require("../lib/react.js"),r=(require("./popup/popup.js"),require("./menubar/menubar.js")),i=require("./toolbar/toolbar.js"),s=require("./sidebar/sidebar.js"),n=require("./develop/develop.js"),p=require("./detail/detail.js"),a=(require("./setting/setting.js"),require("./edit/edit.js")),h=require("../weapp/utils/projectManager.js").manager,m=require("../actions/projectActions.js"),c=require("../stores/projectStores.js"),u=require("./about/about.js"),l=require("../stores/windowStores.js"),d=require("../actions/windowActions.js"),j=(require("../stores/webviewStores.js"),require("../actions/webviewActions.js"),require("../weapp/utils/tools.js")),_=require("../common/menu/menu.js"),g=function(e){d.showTipsMsg({msg:e,type:"error"})},f=o.createClass({displayName:"Main",getInitialState:function(){var e=this.props.project?l.getLastShow():"debug",t=0,o=0;return{show:e,memory:t,cpu:o}},optProject:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};l.setLastShow(e),this.setState({show:e},t)},_fileWatcher:function(o,r,i,s){var n=this;if(this.props.project){var p=l.getEditorConfig("autoRefresh"),a=l.getEditorConfig("autoSave");if(p){e&&clearTimeout(e);var h=function(){var e=t.extname(i);j.whiteFileExtName[e]&&m.restart(n.props.project)};p&&a&&this._fileChangeFromEditor?e=setTimeout(function(){e=void 0,h()},3500):h()}}},_openProjectFile:function(){this.optProject("edit")},_memory:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=0;this._memoryTime++;for(var o in e){var r=e[o];r.privateMemory&&(t+=r.privateMemory)}t=parseInt(t/1024/1024),this._memorySum+=t,this._memoryNow=t,this._memoryPre=parseInt(this._memorySum/this._memoryTime)},_cpu:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=0,o=0;this._cpuTime++;for(var r in e){var i=e[r];i.cpu&&(t+=i.cpu)}this._cpuSUm+=t,t=t.toFixed(2),o=(this._cpuSUm/this._cpuTime).toFixed(2),this._systemCpuSPAN.innerText="内存占用 "+this._memoryNow+"/"+this._memoryPre+" mb, CPU "+t+"/"+o+"%"},_onFileChangeFromEditor:function(){var e=this;this._fileChangeFromEditor=!0,clearTimeout(this._fileChangeFromEditorTimer),this._fileChangeFromEditorTimer=setTimeout(function(){e._fileChangeFromEditorTimer=void 0,e._fileChangeFromEditor=!1},2e3)},componentDidMount:function(e){var t=this;if(h.on("FILE_CHANGE",this._fileWatcher),c.on("FILE_CHANGE_FROM_EDITOR",this._onFileChangeFromEditor),this._memoryTime=0,this._memorySum=0,this._cpuTime=0,this._cpuSUm=0,l.initEditorConfig(),global.appConfig.isDev){var o=this._systemCpuSPAN=document.createElement("span");o.style.cssText="position:absolute;top: 10px;right: 10%;margin-bottom: 10px;",global.contentDocumentBody.appendChild(o),chrome.processes.onUpdatedWithMemory.addListener(this._memory),chrome.processes.onUpdated.addListener(this._cpu)}this.props.project&&c.setProjectConfig(this.props.project,{refresh:!0},function(e){return e?void g(e):void c.setProjectType(t.props.project.hash)})},componentWillUnmount:function(){h.removeListener("FILE_CHANGE",this._fileWatcher),c.removeListener("FILE_CHANGE_FROM_EDITOR",this._onFileChangeFromEditor),global.appConfig.isDev&&(chrome.processes.onUpdatedWithMemory.removeListener(this._memory),chrome.processes.onUpdated.removeListener(this._cpu),this._systemCpuSPAN&&this._systemCpuSPAN.remove())},showSetting:function(){d.showSetting()},setMacMenu:function(){"darwin"===process.platform&&(this.props.project?"edit"===this.state.show?global.nwWindow.menu=_.menuWithEdit:global.nwWindow.menu=_.menu:global.nwWindow.menu=_.webDevMenu)},render:function(){var e="",t="";return this.setMacMenu(),this.props.project&&(e=o.createElement(a,{show:this.state.show,project:this.props.project,optProject:this.optProject}),t=o.createElement(p,{project:this.props.project,optProject:this.optProject,show:this.state.show})),o.createElement("div",{className:"main"},o.createElement(r,{lastWinStatus:this.props.lastWinStatus,appQuit:this.props.appQuit,appMin:this.props.appMin,appMax:this.props.appMax,showSetting:this.showSetting,project:this.props.project,show:this.state.show}),o.createElement(i,{project:this.props.project}),o.createElement("div",{className:"body"},o.createElement(s,{show:this.state.show,project:this.props.project,optProject:this.optProject}),o.createElement(n,{show:this.state.show,optDebugger:this.optDebugger,project:this.props.project}),e,t),o.createElement(u,null))}});_exports=f}var _exports;init(),module.exports=_exports;