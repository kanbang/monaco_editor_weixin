"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function init(){var e=1,t=2,a="X",r="M",n=function(e){return 1e3*e},s=function(e,t,r){var n={pid:e,tid:t,cat:r.category,name:r.name,ph:r.phase,ts:r.start,args:r.args};return r.phase===a&&(n.dur=r.end-r.start),n},o=function(e,t,a){return Object.assign(s(e,t,a),{name:"CPU(%)",min:0,max:100})},i=function(e,t,a){return Object.assign(s(e,t,a),{min:0,max:60})},c=function(e,t,a,r){return Object.assign(s(e,t,a),{name:"MEMORY(MB)",min:0,max:r?r:void 0})},u=function(e,t,a,n){var s={name:a,ph:r,ts:0,pid:e,tid:t,cat:"__metadata",args:n};return s},h=function(){function a(){_classCallCheck(this,a),this._data={traceEvents:[],otherData:{version:"1.0.0"}},this._cachedCategoryThreads=[],this._initData()}return _createClass(a,[{key:"_initData",value:function(){this._data.traceEvents.push(u(e,0,"process_name",{name:"Hardware"})),this._data.traceEvents.push(u(t,0,"process_name",{name:"MiniProgram"})),global.isDev&&this._createCategoryThread("Native"),this._createCategoryThread("API")}},{key:"_createCategoryThread",value:function(e){var a=this._cachedCategoryThreads[this._cachedCategoryThreads.length-1],r=null==a?1:a.tid+1,n=u(t,r,"thread_name",{name:e});return this._data.traceEvents.push(n),n}},{key:"_findCategoryThread",value:function(e){var t=this._cachedCategoryThreads.find(function(t){return t.args.name.toLowerCase()===e.toLowerCase()});return null==t&&(t=this._createCategoryThread(e),this._cachedCategoryThreads.push(t)),t}},{key:"_parseRow",value:function(e){var t=e.split(",");if(t<=0)return console.error("columns length error."),null;var a=t[0],r=t[1],s=t[2],o=parseInt(t[3]),i=parseInt(t[4]),c=void 0;try{c=JSON.parse(decodeURIComponent(t[5]))}catch(e){}return"number"==typeof o&&(o=n(o)),"number"==typeof i&&(i=n(i)),{name:a,category:r,phase:s,start:o,end:i,args:c}}},{key:"parseByLine",value:function(a){var r=this._parseRow(a);if(null!=r){var n=void 0,u=1;if(global.isDev||"native"!==r.category.toLowerCase()){if("hardware"===r.category.toLowerCase())"cpu"===r.name.toLowerCase()?n=o(e,u,r):"fps"===r.name.toLowerCase()?n=i(e,u,r):"memory"===r.name.toLowerCase()&&(n=c(e,u,r,this.totalMem_));else{var h=this._findCategoryThread(r.category);u=h.tid,n=s(t,u,r)}this._data.traceEvents.push(n)}}}},{key:"parse",value:function(e){var t=this;e.split(/\r?\n/).forEach(function(e){t.parseByLine(e)})}},{key:"result",value:function(){return this._data}},{key:"totalMem",set:function(e){this.totalMem_=e}}]),a}();_exports=h}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),_exports;init(),module.exports=_exports;