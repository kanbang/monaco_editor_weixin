"use strict";function init(){var e=require("events").EventEmitter,t=require("../common/jssdk/sdk.js"),i=require("../common/getA8key/getA8key.js"),r=require("../config/errcodeConfig.js"),n=(require("../config/config.js"),require("../common/log/log.js")),o=(require("../config/DeviceModules.js"),require("../config/wordingConfig.js")),s={},_={},S=0,u="app/html/about.html",c={},a=localStorage["webview-network-type"]?localStorage["webview-network-type"]:"wifi",E={appServiceReady:!1},f="",A=Object.assign({},e.prototype,{addWebviewPorts:function(e,t){return c[e]=t,c},delWebviewPorts:function(e){return delete c[e],c},getNetworkType:function(){return a},setNetworkType:function(e){a=e,localStorage["webview-network-type"]=a,this.emit("SIMULATOR_NETWORK_CHANGE",a)},getStatusBarHeight:function(){var e=parseInt(localStorage["webview-status-bar-height"]);return(Number.isNaN(e)||e<0)&&(e=25),e},setStatusBarHeight:function(e){localStorage["webview-status-bar-height"]=e,this.emit("SIMULATOR_STATUS_BAR_HEIGHT_CHANGE",e)},getWebviewPorts:function(){return c},deleteWebviewID:function(e){this.emit("DELETE_WEBVIEW_ID",e)},changeWebviewID:function(e){S=e,this.emit("CHANGE_WEBVIEW_ID",e)},getSnapShot:function(e){return _[e]},setSnapShot:function(e,t){_[e]=t,this.emit("SET_WEBVIEW_SNAPSHOT",e,t)},getInitURL:function(){return u},setInitURL:function(e){u=e},getCurrentWebviewID:function(){return S},setCurrentWebviewID:function(e){S=e},showShare:function(e,t){this.emit("SHOW_SHARE_WEBVIEW_"+e,e,t)},stopPullDownRefresh:function(){this.emit("STOP_PULL_DOWN_REFRESH")},upStatus:function(e,t){s[e]||(s[e]={}),this.emit("UP_WEBVIEW_STATUS_"+e,e,t),this.emit("UP_WEBVIEW_STATUS",e,t)},setAction:function(e,t){s[e]||(s[e]={}),this.emit("SET_WEBVIEW_ACTION_"+e,e,t)},execJSSDK:function(e,i){var o=this;s[e]||(s[e]={}),setTimeout(function(){t.exec(i,s[e],function(t,_,S){var u=i.sdkName,c=S.type;if("CARD_SDK"===c&&t){var a=S.error;if(a){if(a.errcode===r.NOT_LIMITS_CARD)return n.info("webviewStores.js getA8key NOT_LIMITS_CARD"),void o.emit("NOT_LIMITS_CARD");if(0!==a.errcode){n.info("webviewStores.js getA8key "+a.errcode);var E=require("../common/jssdk/sdkNameTrans.js");return _={errMsg:E.getSdkDisplayName(u)+":fail"},void o.emit("GET_JSSDK_RES_"+e,e,u,_,i.ext)}}else o.emit("CRAD_SDK_RES",e,u,_,t,i)}else"PREVERIFY_SDK"===c?(s[e].purviewFromPreVerify=S.purviewFromPreVerify||{},i.sdkResExt=S,o.emit("GET_JSSDK_RES_"+e,e,u,_,i)):"SHARE_SDK"===c?o.emit("SHOW_SHARE_WEBVIEW_"+e,e,i,_):"REGISTER_SDK"===c||("INTERFACE_ASYNC_SDK"===c?o.emit("SET_INTERFACE_ASYNC_RES",e,u,t,i):"INTERFACE_SDK"===c?(o.emit("SET_INTERFACE_RES_"+e,e,u,t,i),o.emit("GET_JSSDK_RES_"+e,e,u,_,i.ext)):o.emit("GET_JSSDK_RES_"+e,e,u,_,i.ext))})})},sendJSSDKRes:function(e,t,i,r){this.emit("GET_JSSDK_RES_"+e,e,t,i,r)},getA8key:function(e,t){var _=this;s[e]={};var S=t.isSync;n.info("webviewStores.js getA8key begin: "+e+" "+JSON.stringify(t)),i.get(t,function(i){n.info("webviewStores.js getA8key end: "+JSON.stringify(i));var u=i.baseresponse,c=parseInt(u.errcode);if(c===r.NOT_LOGIN)return n.info("webviewStores.js getA8key NOT_LOGIN"),void _.emit("NOT_LOGIN");if(c===r.NOT_LIMITS)return n.info("webviewStores.js getA8key NOT_LIMITS"),void _.emit("NOT_LIMITS");if(c===r.NOT_LIMITS_QY)return n.info("webviewStores.js getA8key NOT_LIMITS_QY"),void _.emit("NOT_LIMITS_QY");if(c===r.INVALID_LOGIN||c===r.INVALID_TOKEN)return n.info("webviewStores.js getA8key INVALID_LOGIN"),void _.emit("INVALID_LOGIN");s[e].purviewFormGetA8key=i.purviewFormGetA8key;var a=i.resp_url;if(S||c===r.ILLEGAL_URL)return void setTimeout(function(){_.emit("SET_WEBVIEW_ACTION_"+e,e,{act:"load",url:a,from:t.from})});if(0!==c){n.info("webviewStores.js getA8key "+c);var E=require("../actions/windowActions.js");return void E.showTipsMsg({msg:o[0]+" "+c,type:"error"})}var f=/\#wechat_redirect$/.test(t.url);return f&&t.url.replace(/\#wechat_redirect$/,"")===a?(a=a.replace(/\#wechat_redirect/,""),n.info("webviewStores.js getA8key GETA_8KEY_NOT_SUPPORT "+a),void windowActions.showTipsMsg({msg:""+o[1],type:"error"})):void 0})},getWebviewByID:function(e){return s[e]},clearData:function(e){this.emit("CLEAR_WEBVIEW_DATA",e)},setInterfaceFromPageFrame:function(e,t){this.emit("SET_INTERFACT_FROMPAGEFRAME_"+e,t)},cleanWebview:function(e){this.emit("CLEAN_WEBVIEW_"+e),this.emit("CLEAN_WEBVIEW",e)},asTojs:function(e){this.emit("AS_TO_JS",e)},upASData:function(e,t){this.emit("UP_AS_DATA",e,t)},upBLData:function(e,t){this.emit("UP_BL_DATA",e,t)},asPublish:function(e){this.emit("AS_PUBLISH",e)},postMessageToAS:function(e){this.emit("POST_MSG_TOAS",e)},sendASSdk:function(e,t,i){this.emit("SEND_AS_SDK",e,t,i)},touchSetSuc:function(e){this.emit("TOUCH_SET_SUC_"+e)},togglerRecordWording:function(e){this.emit("TOGGLE_RECORD_WORDING",e)},getGeoSetting:function(){var e=JSON.parse(localStorage.getItem("webivew-geolocation"))||{};return e},setGeoSetting:function(e){localStorage.setItem("webivew-geolocation",JSON.stringify(e))},drawWidgetCanvas:function(e){this.emit("WIDGET_DRAW_CANVAS",e)},getAppServiceReadyState:function(){return E.appServiceReady},setAppServiceReadyState:function(e){E.appServiceReady=e,e&&this.emit("APPSERVICE_INIT")},operatePaymentQrcodeWnd:function(e){this.emit("OPERATE_PAYMENT_QRCODE_WND",e)},showAddCardView:function(e){this.emit("SHOW_ADD_CARD_VIEW",e)},showOpenCardView:function(e){this.emit("SHOW_OPEN_CARD_VIEW",e)},showShareGroupList:function(e){this.emit("SHOW_SHARE_GROUP_LIST",e)},triggerWebviewOnEvent:function(e){this.emit("TRIGGER_WEBVIEW_ON_EVENT",e)},triggerGettingWidgetData:function(e){this.emit("GET_WIDGET_DATA",e)},updateCustomAnalysisConfig:function(e){f=e,this.emit("UPDATE_CUSTOM_ANALYSIS_CONFIG",e)},getCustomAnalysisConfig:function(){return f}}),T=A.on,I={};A.on=function(){var e=arguments,t=e[0];I[t]||(I[t]=0),I[t]++,I[t]>=10&&n.error("webviewStores.js on "+t+" - times: "+I[t]),T.apply(this,arguments)};var m=A.removeListener;A.removeListener=function(){var e=arguments,t=e[0];I[t]&&I[t]--,I[t]>=10&&n.error("webviewStores.js on "+t+" - times: "+I[t]),m.apply(this,arguments)},_exports=A}var _exports;init(),module.exports=_exports;