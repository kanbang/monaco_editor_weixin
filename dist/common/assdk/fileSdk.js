"use strict";function init(){function e(e,i){var t=e.args,r=t.tempFilePath,a=g.getFileStat(r);if(r&&a){var s=f.getCurrentProjectConfig(),l=f.getCurrentProject(),o=g.getSavedFileList(l);if(1024*s.Setting.MaxFileStorageSize*1024<o.totalSize+a.size)i({errMsg:"saveFile:fail the maximum size of the file storage limit is exceeded"});else{var n=g.saveFileForever(r);i(n===!1?{errMsg:"saveFile:fail"}:{errMsg:"saveFile:ok",savedFilePath:n})}}else i({errMsg:"saveFile:fail file not found"})}function i(e,i){var t=e.args,r=t.filePath,a=t.fileType,s=!1;if(a)s=!u["."+a];else{var l=d.extname(r).toLowerCase();s=!u[l]}if(s)return void i({errMsg:"openDocument:fail filetype not supported"});var o=g.getRealPath(r);if(!v.existsSync(o))return void i({errMsg:"openDocument:fail fail file not exist"});if(a){var n=v.readFileSync(o);o=o+"."+a,v.writeFileSync(o,n),nw.Shell.openItem(o)}else nw.Shell.openItem(o);i({errMsg:"openDocument:ok"})}function t(e,i){var t=f.getCurrentProject(),r=g.getSavedFileList(t);i({errMsg:"getSavedFileList:ok",fileList:r.fileList})}function r(e,i){var t=e.args;if(t.filePath){var r=g.getFileStat(t.filePath);i(r?{errMsg:"getSavedFileInfo:ok",size:r.size,createTime:parseInt(r.ctime.getTime()/1e3)}:{errMsg:"getSavedFileInfo:fail file doesn't exist"})}else i({errMsg:"getSavedFileInfo:fail"})}function a(e,i){var t=e.args;i(t.filePath?g.removeSavedFile(t.filePath)?{errMsg:"removeSavedFile:ok"}:{errMsg:"removeSavedFile:fail file doesn't exist"}:{errMsg:"removeSavedFile:fail"})}function s(e,i){var t=e.args,r=f.getCurrentProject();if(t.base64Data){var a=g.saveBase64DataToFile(r,t.base64Data,".png");i(a?{errMsg:"base64ToTempFilePath:ok",tempFilePath:a}:{errMsg:"base64ToTempFilePath:fail"})}else i({errMsg:"base64ToTempFilePath:fail"})}function l(e,i){var t=e.args,r=t.filePath,a=t.length,s=t.position||0,l=g.getRealPath(r);if(!v.existsSync(l))return i({errMsg:"readFile:fail file not found"});var o=v.createReadStream(l,{start:s,end:a?s+a:void 0}),n=[];o.on("data",function(e){n.push(e)}),o.on("end",function(){var e=Buffer.concat(n);i({errMsg:"readFile:ok",data:e.toString("base64")})})}function o(e,i){var t=e.args,r=t.filePath,a=t.digestAlgorithm;if(r){var s=g.getFileStat(r);if(s){var l=s.size,o="";if(a){var n=g.getRealPath(r),f=v.readFileSync(n);if("md5"==a){var d=F.createHash("md5");d.update(f),o=d.digest("hex")}else if("sha1"==a){var u=F.createHash("sha1");u.update(f),o=u.digest("hex")}}i({errMsg:"getSavedFileInfo:ok",size:l,digest:o})}else i({errMsg:"getSavedFileInfo:fail file doesn't exist"})}else i({errMsg:"getFileInfo:fail filePath empty"})}function n(e,i){var t=e.args,r=t.filePath,a=t.data,s=t.position||0,l=g.getRealPath(r);return v.existsSync(l)?void v.open(l,"w",function(e,t){if(e)return i({errMsg:"writeFile:fail "+e});var r=Buffer.from(a,"base64");v.write(t,r,s,r.length,0,function(e,t,r){i(e?{errMsg:"writeFile:fail "+e}:{errMsg:"writeFile:ok"})})}):i({errMsg:"writeFile:fail file not found"})}var f=(require("../../actions/webviewActions.js"),require("../../stores/projectStores.js")),g=require("../../utils/file.js"),v=require("fs"),d=require("path"),F=require("crypto"),u={".doc":!0,".xls":!0,".ppt":!0,".pdf":!0,".docx":!0,".xlsx":!0,".pptx":!0};_exports={saveFile:e,openDocument:i,getSavedFileList:t,getSavedFileInfo:r,getFileInfo:o,removeSavedFile:a,base64ToTempFilePath:s,readFile:l,writeFile:n}}var _exports;init(),module.exports=_exports;