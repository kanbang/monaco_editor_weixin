"use strict";function init(){function e(e,t){var r=0===t.indexOf("http");if(r)e.src=t;else{var a=u.getRealPath(t),i=p.readFileSync(a,"utf8");if(e.src=i,t.indexOf("durationTime=")!==-1){var o=s.extname(t),n=t.replace(/.*durationTime=/,"").replace(o,"");n&&(e._duration=n/1e3)}}}function t(e){c.postMessageToAS({data:e,eventName:"onAudioStateChange"})}function r(e){var r=f[e];r.initStateChage||(r.initStateChage=!0,r.addEventListener("error",function(r){var a=r.currentTarget.error.code,i={audioId:e,state:"error",errMsg:"MediaError",errCode:1e4+parseInt(a)};t(i)}),r.addEventListener("pause",function(a){var i=r._isStop?"stop":"pause";r._isStop=!1;var o={audioId:e,state:i};t(o)}),g.forEach(function(a){r.addEventListener(a,function(){t({audioId:e,state:a})})}))}function a(e,t){var r=+new Date,a=document.createElement("audio");f[r]=a,t({audioId:r,errMsg:"createAudioInstance:ok"})}function i(t,a){var i=t.args,o=i.audioId,n=i.src,s=i.startTime,u=f[o];e(u,n),s&&u.addEventListener("canplay",function(){u.currentTime=s}),u.startTime=s||0,r(o);var d="";try{u.play(),d="setAudioState:ok"}catch(e){d="setAudioState:fail "+e.toString()}a({errMsg:d})}function o(e,t){var r=e.args,a=r.audioId,i=f[a],o=i.duration,n=i.currentTime,s=i.paused,u=i.src,c=i.startTime,p=d.getAudioBufferd(i);o===1/0&&i._duration&&(o=i._duration),t({duration:o,currentTime:n,paused:s,src:u,startTime:c,buffered:p,errMsg:"getAudioState:ok"})}function n(e,t){var r=e.args,a=r.operationType,i=r.audioId,o=r.currentTime,n=f[i],s=void 0;try{"play"===a?n.play():"pause"===a?n.pause():"stop"===a?(n._isStop=!0,n.pause(),n.currentTime=0):"seek"===a&&(n.currentTime=o),s="operateAudio:ok"}catch(e){s="operateAudio:fail "+e.toString()}t({errMsg:s})}var s=require("path"),u=(require("../log/log.js"),require("../../utils/file.js")),d=require("../../utils/tools.js"),c=(require("../../stores/projectStores.js"),require("../../actions/webviewActions.js")),p=require("fs"),f={},g=["play","canplay","ended","stop","waiting","seeking","seeked"];_exports={createAudioInstance:a,setAudioState:i,getAudioState:o,operateAudio:n}}var _exports;init(),module.exports=_exports;