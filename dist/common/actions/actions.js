"use strict";function init(){function e(){return"edit"===n.getLastShow()}var o=this,t=require("../../actions/webviewActions.js"),r=require("../../stores/webviewStores.js"),n=(require("../../stores/projectStores.js"),require("../../stores/windowStores.js")),i=require("../../actions/windowActions.js"),a=require("../../actions/projectActions.js"),c=require("../../stores/configStores.js"),d=require("../../common/request/request.js"),s=(require("../../config/errcodeConfig.js"),require("../log/log.js")),p=require("../../utils/newReport.js"),m=("darwin"===process.platform,require("../../config/urlConfig.js")),u=m.getBbsTicket,l=m.checkApiAuth,g=m.getAuthList,f=m.setAuth,h=m.getUserPhoneNumber,v=m.checkWeRunState,x=m.searchWidgetTrans,w=!1;n.on("EDITOR_FOCUS",function(){return w=!0}),n.on("EDITOR_BLUR",function(){return w=!1}),_exports={newFile:function(){e()&&i.execEditorCommand({command:"newTempFile"})},save:function(){e()&&i.execEditorCommand({command:"save"})},saveAll:function(){e()&&i.execEditorCommand({command:"saveAll"})},closeFile:function(){e()&&i.execEditorCommand({command:"close"})},closeProject:function(){a.close(),p("project_close",o.props.project.appid)},undo:function(){e()&&i.execEditorCommand({command:"undo"})},redo:function(){e()&&i.execEditorCommand({command:"redo"})},copy:function(){e()&&n.isEditorFocus()?i.execEditorCommand({command:"copy"}):global.contentDocument.execCommand("copy")},cut:function(){e()&&n.isEditorFocus()?i.execEditorCommand({command:"cut"}):global.contentDocument.execCommand("cut")},paste:function(){e()&&n.isEditorFocus()?i.execEditorCommand({command:"paste",data:nw.Clipboard.get().get("text")}):global.contentDocument.execCommand("paste")},unindent:function(){e()&&i.execEditorCommand({command:"unindent"})},indent:function(){e()&&i.execEditorCommand({command:"indent"})},format:function(){e()&&i.execEditorCommand({command:"format"})},moveLineUp:function(){e()&&i.execEditorCommand({command:"moveLineUp"})},moveLineDown:function(){e()&&i.execEditorCommand({command:"moveLineDown"})},copyLineUp:function(){e()&&i.execEditorCommand({command:"copyLineUp"})},copyLineDown:function(){e()&&i.execEditorCommand({command:"copyLineDown"})},find:function(){e()&&i.execEditorCommand({command:"find"})},globalFind:function(){e()&&i.execEditorCommand({command:"globalFind"})},replace:function(){e()&&i.execEditorCommand({command:"replace"})},toggleSimulatorView:function(){i.execEditorCommand({command:"toggleSimulatorView"})},toggleFileTreeView:function(){i.execEditorCommand({command:"toggleFileTreeView"})},gotoFile:function(){e()&&i.execEditorCommand({command:"gotoFile"})},gotoRecentFile:function(){e()&&i.execEditorCommand({command:"gotoRecentFile"})},gotoPreviousEditor:function(){e()&&i.execEditorCommand({command:"gotoPreviousEditor"})},gotoNextEditor:function(){e()&&i.execEditorCommand({command:"gotoNextEditor"})},reBuild:function(){var e=r.getCurrentWebviewID();t.setWebviewAction(e,{act:"reBuild"})},showSetting:function(){i.showSetting()},customAnalysis:function(){i.showCustomAnalysis()},jumpDoc:function(){nw.Shell.openExternal("https://mp.weixin.qq.com/debug/wxadoc/dev/framework/MINA.html")},jumpBbs:function(e){d({url:u,needToken:1},function(o,t,r){if(!o){var n=JSON.parse(r),a=n.open_ticket;a?e?nw.Shell.openExternal(e+"&devcode="+a):nw.Shell.openExternal("https://developers.weixin.qq.com/welogin?devcode="+a):i.showConfirm({content:"登录社区失败 错误信息  "+r,type:"alert",callback:function(){}})}})},showChangeLog:function(){nw.Shell.openExternal("https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/download.html")},showAbout:function(){i.showAbout()},tryBeta:function(){nw.Shell.openExternal("https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/beta.html")},reload:function(){var e=r.getCurrentWebviewID();t.setWebviewAction(e,{act:"reLoad"})},goback:function(){var e=r.getCurrentWebviewID();t.setWebviewAction(e,{act:"goBack"})},goforward:function(){var e=r.getCurrentWebviewID();t.setWebviewAction(e,{act:"goForward"})},focusAddressBar:function(){var e=r.getCurrentWebviewID();i.focusAddressBar(e)},checkApiAuth:function(e,o){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=e.appid,n=e.ext_appid,i=e.platform;d({url:l+"?appid="+r+"&ext_appid="+n+"&platform="+(i?1:0)+"&_r="+Math.random(),method:"post",body:JSON.stringify({appid:e.ext_appid?e.ext_appid:e.appid,jsapi:o}),needToken:1},function(e,o,r){if(e)return t(e);var n=void 0;try{n=JSON.parse(r);var i=n.baseresponse,a=i?parseInt(i.errcode):-1e4;if(0===a)t(null,{desc:n.auth_desc,scope:n.scope,state:n.state});else{var c=i?i.errmsg:"unknown error "+a;t(c)}}catch(e){return void t("system error "+e)}})},getAuthList:function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},t=e.appid,r=e.ext_appid,n=e.platform;d({url:g+"?appid="+t+"&ext_appid="+r+"&platform="+(n?1:0)+"&_r="+Math.random(),method:"post",body:JSON.stringify({appid:e.ext_appid?e.ext_appid:e.appid}),needToken:1},function(e,t,r){if(e)return o(e);var n=void 0;try{n=JSON.parse(r)}catch(e){return void o("system error "+r)}var i=n.baseresponse,a=i?parseInt(i.errcode):-1e4;0===a?o(null,n.auth_item):(s.error("common/actions/actions.js getAuthList error "+a),o(a))})},setAuth:function(e,o){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=e.appid,n=e.ext_appid,i=e.platform;d({url:f+"?appid="+r+"&ext_appid="+n+"&platform="+(i?1:0)+"&_r="+Math.random(),method:"post",body:JSON.stringify({appid:e.ext_appid?e.ext_appid:e.appid,auth_item:o}),needToken:1},function(e,o,r){if(e)return t(e);var n=void 0;try{n=JSON.parse(r)}catch(e){return void t("system error "+r)}var i=n.baseresponse,a=i?parseInt(i.errcode):-1e4;0===a?t(null):(s.error("common/actions/actions.js setAuth error "+a),t(a))})},getUserPhoneNumber:function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},t=e.appid,r=e.ext_appid,n=e.platform;d({url:h+"?appid="+t+"&ext_appid="+r+"&platform="+(n?1:0)+"&_r="+Math.random(),method:"post",body:JSON.stringify({appid:e.ext_appid?e.ext_appid:e.appid}),needToken:1},function(e,t,r){if(e)return o("系统错误 "+e);var n=void 0;try{n=JSON.parse(r)}catch(e){return s.error("common/actions/actions.js getUserPhoneNumber error "+r),void o("系统错误 "+r)}var i=n.jsapi_baseresponse,a=i?parseInt(i.errcode):-1e4;if(0===a)try{var c=JSON.parse(n.data);o(null,c)}catch(e){o("获取数据错误 "+e)}else a==-12001?o("该 appid 没有权限"):a==-12004?o("请先使用 wx.login 登录"):(s.error("common/actions/actions.js getUserPhoneNumber error "+a),o("系统错误 errorCode:"+a))})},checkWeRunState:function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},t=e.appid,r=e.ext_appid,n=e.platform;d({url:v+"?appid="+t+"&ext_appid="+r+"&platform="+(n?1:0)+"&_r="+Math.random(),method:"post",body:JSON.stringify({appid:e.ext_appid?e.ext_appid:e.appid}),needToken:1},function(e,t,r){if(e)return o("系统错误 "+e);var n=void 0;try{n=JSON.parse(r)}catch(e){return s.error("common/actions/actions.js checkWeRunState error "+r),void o("系统错误 "+r)}var i=n.baseresponse,a=i?parseInt(i.errcode):-1e4;0===a?o(null,n.state,n.wording):(s.error("common/actions/actions.js checkWeRunState error "+a),o("系统错误 errorCode:"+a))})},getSearchWidgetQueryOptions:function(e){var o=e.appid,t=e.ext_appid,r=e.platform;d({url:x+"?appid="+o+"&ext_appid="+t+"&platform="+(r?1:0)+"&_r="+Math.random(),method:"post",body:JSON.stringify({cgi_type:1,req_data:JSON.stringify({})}),needToken:1},function(e,o,t){if(e)return void s.error("common/actions/actions.js getSearchWidgetQueryOptions error "+e);var r=void 0;try{r=JSON.parse(t)}catch(e){return i.showTipsMsg({type:"error",msg:"获取搜索配置解析失败"}),void s.error("common/actions/actions.js getSearchWidgetQueryOptions parse "+t+" catch error "+e)}var n=r.baseresponse,a=n?parseInt(n.errcode):-1e4;if(0==a){var d=void 0;try{d=JSON.parse(r.resp_data),c.setSearchQuery(d)}catch(e){i.showTipsMsg({type:"error",msg:"获取搜索配置解析失败"}),s.error("common/actions/actions.js getSearchWidgetQueryOptions parse resp_data error "+e)}}else i.showTipsMsg({type:"error",msg:"获取搜索配置失败："+a+", "+n.errmsg}),s.error("common/actions/actions.js getSearchWidgetQueryOptions errcode "+a)})},getSearchWidgetInitData:function(e,o){var t=e.appid,r=e.ext_appid,n=e.platform,a=e.widgetOptions||{},c=a.currentService&&a.currentService.box_type;d({url:x+"?appid="+t+"&ext_appid="+r+"&platform="+(n?1:0)+"&_r="+Math.random(),method:"post",body:JSON.stringify({cgi_type:2,req_data:JSON.stringify({box_type:c,box_qi:a.boxQI,query:a.searchQuery||"",debugurl:a.debugurl||""})}),needToken:1},function(e,t,r){if(e)return s.error("common/actions/actions.js getSearchWidgetInitData error "+e),o(e);var n=void 0;try{n=JSON.parse(r)}catch(e){return i.showTipsMsg({type:"error",msg:"获取搜索内容解析失败"}),s.error("common/actions/actions.js getSearchWidgetInitData parse "+r+" catch error "+e),o(e)}var a=n.baseresponse,c=a?parseInt(a.errcode):-1e4;if(0==c){var d=void 0;try{d=JSON.parse(n.resp_data),o(null,d)}catch(e){i.showTipsMsg({type:"error",msg:"获取搜索内容解析失败"}),s.error("common/actions/actions.js getSearchWidgetInitData parse resp_data error "+e),o(e)}}else s.error("common/actions/actions.js getSearchWidgetInitData errcode "+c+", "+a.errmsg),i.showTipsMsg({type:"error",msg:"获取搜索内容失败："+c+", "+a.errmsg}),o(c)})}}}var _exports;init(),module.exports=_exports;